#!/bin/bash
# XMonad startup script with system tray and automatic monitor detection

# Ensure user bin is in PATH for dmenu
export PATH="$HOME/bin:$PATH"

# Load Xresources
[ -f ~/.Xresources ] && xrdb -merge ~/.Xresources

# Set keyboard options
setxkbmap -option ctrl:nocaps

# Enable NumLock by default
if command -v numlockx > /dev/null 2>&1; then
    numlockx on
elif command -v setleds > /dev/null 2>&1; then
    # Fallback: try setleds for console (may not work in X)
    setleds -D +num 2>/dev/null || true
    # Also try xset if available
    if command -v xset > /dev/null 2>&1; then
        xset led named "Num Lock" 2>/dev/null || xset led 1 2>/dev/null || true
    fi
fi

# Detect and configure monitors with autorandr
# This will automatically apply the best matching profile
if command -v autorandr > /dev/null 2>&1; then
    autorandr --change --default laptop
fi

# Start system tray
stalonetray &

# Start network manager applet
nm-applet --indicator &

# Start volume control (pasystray for PulseAudio)
# Set GTK theme for proper icon display
GTK_THEME=Adwaita XDG_CURRENT_DESKTOP=GNOME pasystray &

# Start Bluetooth manager
blueman-applet &

# Optional: Add other tray applications here
# cbatticon &
# redshift-gtk &

# Start XMonad
exec xmonad